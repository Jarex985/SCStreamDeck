/* generated: pi-control-panel.js */
(function(){function r(n){const t=new Map,u=Array.isArray(n?.channels)?n.channels:[];for(const n of u)n&&typeof n.channel=="string"&&t.set(n.channel,n);const r=[];for(const n of i){const i=t.get(n),u=!!i?.valid;if(u){const f=!!i?.isCustomPath;r.push({value:n,text:`${n.toUpperCase()} - ${f?"Custom":"Auto"}`})}}return r}function t(n,t){const i=document.getElementById(n);if(i){const r=i.parentElement&&i.parentElement.classList.contains("pi-inline-banner")?i.parentElement:null,u=String(t||"").trim();if(u.length===0){i.textContent="";i.style.display="none";r&&(r.style.display="none");return}i.textContent=u;i.style.display="block";r&&(r.style.display="flex")}}function u(n){const i=Array.isArray(n?.channels)?n.channels:[],r=i.some(n=>!!n?.configured),u=i.some(n=>!!n?.valid);if(u){t("pi-install-warning","");return}if(!r){t("pi-install-warning","No installation detected. Set custom path.");return}t("pi-install-warning","No installation detected. Set custom path.")}function f(){function t(t,u){const f=n?.ui?.filePicker?.createFilePicker?.({rootId:u,displayMode:"full",onValueChanged:n=>{r?.("setDataP4KOverride",{channel:t,dataP4KPath:n||""})}});i.set(t,f)}const i=new Map,r=n?.bus?.send||n?.util?.sendToPlugin||globalThis.sendToPlugin;return t("Live","liveP4KPicker"),t("Hotfix","hotfixP4KPicker"),t("Ptu","ptuP4KPicker"),t("Eptu","eptuP4KPicker"),i}function e(n,t){const u=Array.isArray(n?.channels)?n.channels:[],r=new Map;for(const n of u)n&&typeof n.channel=="string"&&r.set(n.channel,n);for(const n of i){const i=t.get(n);if(i){const u=r.get(n),f=u?.isCustomPath?String(u?.dataP4KPath||""):"";i.setValue(f,{persist:!1,silent:!0})}}}const n=globalThis.SCPI,i=["Live","Hotfix","Ptu","Eptu"];n?.util?.onDocumentReady?.(()=>{n?.bus?.start?.();n?.theme?.initThemeDropdown?.({rootId:"themeDropdown",linkId:"pi-theme-styles"});const o=f(),i=n?.bus?.send||n?.util?.sendToPlugin||globalThis.sendToPlugin,t=n?.ui?.dropdown?.initDropdown?.({rootId:"channelDropdown",searchEnabled:!1,displaySelectedInInput:!0,minLoadingMs:500,successFlashMs:220,emptyText:"No valid channels",getText:n=>String(n?.text??""),getValue:n=>String(n?.value??""),onSelect:n=>{const t=String(n?.value||"");t&&i?.("setChannel",{channel:t})}});t?.setLoading?.(!0,"Loading status");const s=document.getElementById("factoryResetBtn"),h=document.getElementById("forceRedetectBtn");s?.addEventListener("click",()=>{const n=globalThis.confirm?.("Factory Reset will remove cached installations, clear all custom Data.p4k overrides, reset theme selection, and rebuild keybindings from scratch.\n\nContinue?");n&&i?.("factoryReset")});h?.addEventListener("click",()=>{i?.("forceRedetection")});n?.bus?.on?.(n=>{if(n?.controlPanelLoaded){const i=n.controlPanel||{},f=r(i);t?.setItems?.(f);t?.setLoading?.(!1);const h=String(i?.preferredChannel||""),c=String(i?.currentChannel||""),s=c||h,l=s&&f.some(n=>String(n?.value||"")===s);l?t?.setSelectedValue?.(s,{rerender:!0}):f.length>0?t?.setSelectedValue?.(String(f[0].value||""),{rerender:!0}):t?.setSelectedValue?.("",{rerender:!0});u(i);e(i,o)}});n?.bus?.sendOnce?.("pi.connected","propertyInspectorConnected")})})()
